# This file was autogenerated by the GOTM CLI and may require modification

# Building Frontend
FROM node:22 AS web
WORKDIR /build
COPY frontend/package*.json ./
RUN npm install
COPY frontend/ .
RUN npm run build

# Building Backend
FROM golang:latest AS go
WORKDIR /build
COPY go.mod go.sum* ./
RUN go mod download
COPY controllers/ ./controllers/
COPY services*/ ./services/
COPY repositories*/ ./repositories/
COPY main.go .
RUN CGO_ENABLED=1 GOOS=linux go build -a -ldflags="-extldflags '-static'" -o main .

# Building Runner
FROM scratch AS runner
WORKDIR /app

COPY --from=web /build/index.html ./frontend/index.html
COPY --from=web /build/dist/ ./frontend/dist/
COPY --from=web /build/assets*/ ./frontend/assets/
COPY --from=web /build/favicon.ico ./frontend/favicon.ico

COPY --from=go /build/main ./main

EXPOSE 3000
CMD ["/app/main"]


